# çƒçƒå¤§ä½œæˆ˜ - æ’è¡Œæ¦œä¸AIç³»ç»Ÿè¯¦ç»†è®¾è®¡

## ğŸ“Š ç³»ç»Ÿæ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°çƒçƒå¤§ä½œæˆ˜çš„æ’è¡Œæ¦œç³»ç»Ÿå’ŒAIç©å®¶ç”Ÿæˆç³»ç»Ÿçš„å®ç°æ–¹æ¡ˆã€‚

---

## ğŸ† æ’è¡Œæ¦œç³»ç»Ÿ

### 1. æŠ€æœ¯é€‰å‹ï¼šPantry.cloud

**é€‰æ‹©ç†ç”±ï¼š**
- âœ… å…è´¹ä½¿ç”¨ï¼Œæ— éœ€æ³¨å†Œ
- âœ… RESTful APIï¼Œç®€å•æ˜“ç”¨
- âœ… æ”¯æŒJSONæ ¼å¼ï¼Œçµæ´»å­˜å‚¨
- âœ… é€‚åˆå°å‹é¡¹ç›®ï¼ˆ<1000æ¡è®°å½•ï¼‰
- âœ… å…¬å…±å¯è®¿é—®ï¼Œæ— éœ€è®¤è¯

**é™åˆ¶ï¼š**
- âš ï¸ æ•°æ®å®Œå…¨å…¬å¼€ï¼ˆä»»ä½•äººå¯è¯»å–ï¼‰
- âš ï¸ æ²¡æœ‰è®¿é—®æ§åˆ¶ï¼ˆä»»ä½•äººå¯å†™å…¥ï¼‰
- âš ï¸ æœ‰è¯·æ±‚é¢‘ç‡é™åˆ¶
- âš ï¸ æ•°æ®å¯èƒ½è¢«è¦†ç›–ï¼ˆå¹¶å‘å†™å…¥ï¼‰

### 2. æ•°æ®ç»“æ„è®¾è®¡

```json
{
  "scores": [
    {
      "id": "1739097600000_abc123xyz",
      "playerName": "çƒçƒå¤§å¸ˆ",
      "score": 15000,
      "kills": 25,
      "survivalTime": 180,
      "mode": "challenge",
      "difficulty": "normal",
      "timestamp": "2026-02-09T10:30:00Z",
      "playerData": {
        "skin": "rainbow",
        "maxMass": 15000
      }
    }
  ],
  "lastUpdated": "2026-02-09T10:30:00Z"
}
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | string | å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆæ—¶é—´æˆ³_éšæœºå­—ç¬¦ä¸²ï¼‰ |
| `playerName` | string | ç©å®¶æ˜µç§°ï¼ˆå·²æ¸…ç†XSSï¼‰ |
| `score` | number | å¾—åˆ†ï¼ˆè´¨é‡ï¼‰ |
| `kills` | number | å‡»æ€æ•° |
| `survivalTime` | number | å­˜æ´»æ—¶é—´ï¼ˆç§’ï¼‰ |
| `mode` | string | æ¸¸æˆæ¨¡å¼ï¼ˆchallenge/endless/timedï¼‰ |
| `difficulty` | string | éš¾åº¦ï¼ˆeasy/normal/hardï¼‰ |
| `timestamp` | string | æäº¤æ—¶é—´ï¼ˆISO 8601ï¼‰ |
| `playerData` | object | é¢å¤–ç©å®¶æ•°æ® |
| `playerData.skin` | string | çš®è‚¤ |
| `playerData.maxMass` | number | æœ€å¤§è´¨é‡ |

### 3. APIæ¥å£è®¾è®¡

#### 3.1 è·å–æ’è¡Œæ¦œ

```javascript
// è·å–å®Œæ•´æ’è¡Œæ¦œ
const data = await leaderboardService.getLeaderboard()

// è·å–å‰100å
const top100 = await leaderboardService.getTopScores(100)

// è·å–æŒ‘æˆ˜æ¨¡å¼çš„å‰50å
const top50 = await leaderboardService.getTopScores(50, 'challenge')

// è·å–å›°éš¾æ¨¡å¼çš„å‰50å
const top50Hard = await leaderboardService.getTopScores(50, 'challenge', 'hard')
```

#### 3.2 æäº¤æˆç»©

```javascript
const result = await leaderboardService.submitScore({
  playerName: 'çƒçƒå¤§å¸ˆ',
  score: 15000,
  kills: 25,
  survivalTime: 180,
  mode: 'challenge',
  difficulty: 'normal',
  skin: 'rainbow',
  maxMass: 15000
})

// è¿”å›ç»“æœ
{
  success: true,
  score: { ... },
  rank: 42,
  message: 'æˆç»©å·²æäº¤ï¼æ’å: 42'
}
```

#### 3.3 è·å–éšæœºç©å®¶ï¼ˆAIç”¨ï¼‰

```javascript
// è·å–10ä¸ªåˆ†æ•°>1000çš„éšæœºç©å®¶
const players = await leaderboardService.getRandomPlayers(10, 1000)
```

### 4. å®‰å…¨æªæ–½

#### 4.1 é˜²æ­¢XSSæ”»å‡»
```javascript
_sanitizePlayerName(name) {
  // ç§»é™¤HTMLæ ‡ç­¾
  const clean = name.replace(/<[^>]*>/g, '')
  // ç§»é™¤ç‰¹æ®Šå­—ç¬¦
  .replace(/[<>\"']/g, '')
  .trim()

  // é™åˆ¶é•¿åº¦
  return clean.substring(0, 20) || 'åŒ¿åç©å®¶'
}
```

#### 4.2 æ•°æ®éªŒè¯
```javascript
// éªŒè¯å¿…å¡«å­—æ®µ
if (!scoreData.playerName || !scoreData.score) {
  throw new Error('ç¼ºå°‘å¿…å¡«å­—æ®µ')
}

// ç¡®ä¿åˆ†æ•°æ˜¯æ•´æ•°
score: Math.floor(scoreData.score)
```

#### 4.3 é˜²æ­¢å¹¶å‘è¯·æ±‚
```javascript
// ä½¿ç”¨è¯·æ±‚é˜Ÿåˆ—
if (this.pendingRequests.has(cacheKey)) {
  return this.pendingRequests.get(cacheKey)
}
```

### 5. æ€§èƒ½ä¼˜åŒ–

#### 5.1 ç¼“å­˜æœºåˆ¶
- æœ¬åœ°ç¼“å­˜60ç§’
- é¿å…é¢‘ç¹APIè¯·æ±‚
- å¤±è´¥æ—¶è¿”å›ç¼“å­˜æ•°æ®

#### 5.2 æ•°æ®é™åˆ¶
- åªä¿ç•™å‰1000å
- å®šæœŸæ¸…ç†æ—§æ•°æ®
- åˆ†é¡µåŠ è½½ï¼ˆå¯é€‰ï¼‰

---

## ğŸ¤– AIç©å®¶ç”Ÿæˆç³»ç»Ÿ

### 1. è®¾è®¡ç†å¿µ

**æ ¸å¿ƒæƒ³æ³•ï¼š**
ä»æ’è¡Œæ¦œä¸­æå–çœŸå®ç©å®¶æ•°æ®ï¼Œç”Ÿæˆå…·æœ‰è¯¥ç©å®¶ç‰¹å¾çš„AIæ•Œäººï¼Œè®©ç©å®¶åœ¨æ— å°½æ¨¡å¼ä¸­æŒ‘æˆ˜"çœŸå®ç©å®¶"çš„å…‹éš†ä½“ã€‚

**ä¼˜åŠ¿ï¼š**
- âœ… å¢åŠ æ¸¸æˆçœŸå®æ„Ÿ
- âœ… AIè¡Œä¸ºå¤šæ ·åŒ–
- âœ… æ¿€åŠ±ç©å®¶æäº¤æˆç»©
- âœ… æ— å°½æ¨¡å¼æ›´æœ‰æŒ‘æˆ˜æ€§

### 2. AIè¡Œä¸ºå‚æ•°

ä»æ’è¡Œæ¦œæ•°æ®æ¨å¯¼AIè¡Œä¸ºï¼š

```javascript
behavior: {
  // æ”»å‡»æ€§ = å‡»æ€æ•° / 50ï¼ˆæœ€é«˜0.9ï¼‰
  aggressiveness: clamp(kills / 50, 0.3, 0.9),

  // èº²é¿èƒ½åŠ› = å­˜æ´»æ—¶é—´ / 300ç§’ï¼ˆæœ€é«˜0.9ï¼‰
  evasion: clamp(survivalTime / 300, 0.4, 0.9),

  // åˆ†èº«ä½¿ç”¨é¢‘ç‡ = åˆ†æ•° / 20000ï¼ˆæœ€é«˜0.8ï¼‰
  splitUsage: clamp(score / 20000, 0.2, 0.8),

  // ååº”é€Ÿåº¦ = 500ms - åˆ†æ•°/100ï¼ˆæœ€å¿«100msï¼‰
  reactionTime: clamp(500 - score/100, 100, 800),

  // é¢„æµ‹èƒ½åŠ› = åˆ†æ•° / 30000ï¼ˆæœ€é«˜0.7ï¼‰
  prediction: clamp(score / 30000, 0.1, 0.7)
}
```

### 3. AIç”Ÿæˆç­–ç•¥

#### 3.1 æŒ‘æˆ˜æ¨¡å¼AI
```javascript
// æ¸¸æˆå¼€å§‹æ—¶ç”Ÿæˆ20ä¸ªAI
const aiPlayers = await generateAIPlayers({
  count: 20,
  minScore: 1000,
  includeBasic: true,
  difficulty: 'normal'
})
```

#### 3.2 æ— å°½æ¨¡å¼AIï¼ˆåŠ¨æ€ç”Ÿæˆï¼‰
```javascript
// æ¯30ç§’ç”Ÿæˆä¸€ä¸ªæ–°AI
setInterval(async () => {
  const aiPlayer = await spawnPlayerAI(
    gameTime,
    currentPlayer.mass * 0.8 // AIè´¨é‡åŸºäºç©å®¶è´¨é‡
  )

  game.addAI(aiPlayer)
}, 30000)
```

### 4. AIéš¾åº¦è°ƒæ•´

| éš¾åº¦ | è´¨é‡å€æ•° | è¡ŒåŠ¨é¢‘ç‡ | ååº”é€Ÿåº¦ |
|------|---------|---------|---------|
| easy | 0.7x | æ…¢ | 600-800ms |
| normal | 1.0x | æ­£å¸¸ | 400-600ms |
| hard | 1.5x | å¿« | 200-400ms |

---

## ğŸ® æ¸¸æˆæµç¨‹

### æŒ‘æˆ˜æ¨¡å¼æµç¨‹

```
1. ç©å®¶é€‰æ‹©éš¾åº¦
   â†“
2. å¼€å§‹æ¸¸æˆï¼Œç”Ÿæˆ20ä¸ªAIï¼ˆ10ä¸ªæ’è¡Œæ¦œAI + 10ä¸ªåŸºç¡€AIï¼‰
   â†“
3. æ¸¸æˆè¿›è¡Œä¸­...
   â†“
4. æ¸¸æˆç»“æŸï¼ˆè¢«åå™¬æˆ–æ—¶é—´åˆ°ï¼‰
   â†“
5. æ˜¾ç¤ºç»“ç®—ç•Œé¢
   â†“
6. ç©å®¶é€‰æ‹©æ˜¯å¦æäº¤æˆç»©
   â†“
7. å¦‚æœé€‰æ‹©"æ˜¯"
   - è¾“å…¥æ˜µç§°
   - æäº¤åˆ°æ’è¡Œæ¦œ
   - æ˜¾ç¤ºæ’åå’Œæ’åå˜åŒ–
   â†“
8. è¿”å›ä¸»èœå•
```

### æ— å°½æ¨¡å¼æµç¨‹

```
1. ç©å®¶é€‰æ‹©éš¾åº¦
   â†“
2. é€‰æ‹©æ˜¯å¦å¯ç”¨"ç©å®¶AI"åŠŸèƒ½
   â˜‘ å¯ç”¨ï¼šä»æ’è¡Œæ¦œæŠ½å–AI
   â˜ å…³é—­ï¼šåªä½¿ç”¨åŸºç¡€AI
   â†“
3. å¼€å§‹æ¸¸æˆï¼Œåˆå§‹10ä¸ªAI
   â†“
4. æ¯30ç§’ç”Ÿæˆä¸€ä¸ªæ–°çš„AI
   - å¦‚æœå¯ç”¨ç©å®¶AIï¼š70%æ¦‚ç‡ä»æ’è¡Œæ¦œç”Ÿæˆ
   - å¦‚æœå…³é—­ç©å®¶AIï¼š100%ä½¿ç”¨åŸºç¡€AI
   â†“
5. AIè´¨é‡éšæ—¶é—´å¢é•¿
   - æ¯åˆ†é’Ÿå¢åŠ 100è´¨é‡
   â†“
6. æ¸¸æˆç»“æŸï¼ˆè¢«åå™¬ï¼‰
   â†“
7. å¯é€‰æ‹©æäº¤æˆç»©ï¼ˆè®°å½•å­˜æ´»æ—¶é—´ï¼‰
   â†“
8. è¿”å›ä¸»èœå•
```

---

## ğŸ–¥ï¸ UIè®¾è®¡

### ç»“ç®—ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸ® æ¸¸æˆç»“æŸ                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                    â”‚
â”‚  æœ€ç»ˆè´¨é‡: 15,000                   â”‚
â”‚  å‡»æ€æ•°: 25                         â”‚
â”‚  å­˜æ´»æ—¶é—´: 3åˆ†00ç§’                   â”‚
â”‚  æ’å: 42 / 1,234                   â”‚
â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ† æ˜¯å¦æäº¤æˆç»©åˆ°æ’è¡Œæ¦œï¼Ÿ    â”‚ â”‚
â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚  æ˜µç§°: [çƒçƒå¤§å¸ˆ_________]    â”‚ â”‚
â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚  [æäº¤æˆç»©] [è·³è¿‡]           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ’è¡Œæ¦œç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ† å…¨çƒæ’è¡Œæ¦œ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å…¨éƒ¨] [æŒ‘æˆ˜] [æ— å°½] [é™æ—¶]       â”‚
â”‚  [å…¨éƒ¨] [ç®€å•] [æ™®é€š] [å›°éš¾]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ’å  ç©å®¶      åˆ†æ•°    å‡»æ€  æ—¶é—´ â”‚
â”‚  ğŸ¥‡   çƒçƒä¹‹ç‹   25000   50   5:00â”‚
â”‚  ğŸ¥ˆ   åå™¬å¤§å¸ˆ   23000   45   4:30â”‚
â”‚  ğŸ¥‰   ç”Ÿå­˜ä¸“å®¶   21000   40   4:00â”‚
â”‚   4   åˆ†è£‚ç‹‚é­”   20000   35   3:50â”‚
â”‚   5   å½©è±†æ€æ‰‹   19000   30   3:30â”‚
â”‚  ...                               â”‚
â”‚  42  çƒçƒå¤§å¸ˆ   15000   25   3:00  â”‚ â† ä½ çš„æˆç»©
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [åˆ·æ–°] [å…³é—­]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ— å°½æ¨¡å¼è®¾ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       â±ï¸ æ— å°½ç”Ÿå­˜æ¨¡å¼               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                    â”‚
â”‚  éš¾åº¦é€‰æ‹©:                          â”‚
â”‚  â—‹ ç®€å•  â— æ™®é€š  â—‹ å›°éš¾            â”‚
â”‚                                    â”‚
â”‚  é«˜çº§è®¾ç½®:                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â˜‘ å¯ç”¨"ç©å®¶AI"åŠŸèƒ½           â”‚ â”‚
â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚ ä»æ’è¡Œæ¦œä¸­æŠ½å–çœŸå®ç©å®¶ä½œä¸º    â”‚ â”‚
â”‚  â”‚ AIæ•Œäººï¼Œå¢åŠ æŒ‘æˆ˜æ€§ï¼         â”‚ â”‚
â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚ AIåˆ·æ–°é—´éš”: [30â–¼] ç§’         â”‚ â”‚
â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚ åˆå§‹AIæ•°é‡: [10â–¼] ä¸ª         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚
â”‚  [å¼€å§‹æ¸¸æˆ] [è¿”å›]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ æ›´å¥½çš„å®ç°å»ºè®®

### 1. æ•°æ®éªŒè¯ä¼˜åŒ– âš ï¸

**é—®é¢˜ï¼š** Pantryæ²¡æœ‰åç«¯éªŒè¯ï¼Œå¯èƒ½å‡ºç°åˆ·åˆ†

**è§£å†³æ–¹æ¡ˆï¼š**
```javascript
// å®¢æˆ·ç«¯åŸºæœ¬éªŒè¯
function validateScore(scoreData) {
  // 1. æ£€æŸ¥åˆ†æ•°åˆç†æ€§
  if (scoreData.score > 100000) {
    return { valid: false, reason: 'åˆ†æ•°å¼‚å¸¸' }
  }

  // 2. æ£€æŸ¥å‡»æ€æ•°ä¸åˆ†æ•°çš„å…³ç³»
  const expectedScore = scoreData.kills * 500 + scoreData.survivalTime * 10
  if (scoreData.score > expectedScore * 2) {
    return { valid: false, reason: 'åˆ†æ•°ä¸æ¸¸æˆæ•°æ®ä¸åŒ¹é…' }
  }

  // 3. æ£€æŸ¥æ—¶é—´æˆ³
  const timeDiff = Date.now() - new Date(scoreData.timestamp)
  if (timeDiff > 60000) { // è¶…è¿‡1åˆ†é’Ÿ
    return { valid: false, reason: 'æ—¶é—´æˆ³å¼‚å¸¸' }
  }

  return { valid: true }
}
```

### 2. æ•°æ®å»é‡ âš ï¸

**é—®é¢˜ï¼š** åŒä¸€ç©å®¶å¯èƒ½å¤šæ¬¡æäº¤ç›¸è¿‘åˆ†æ•°

**è§£å†³æ–¹æ¡ˆï¼š**
```javascript
// æäº¤å‰æ£€æŸ¥æ˜¯å¦å·²æœ‰ç›¸è¿‘åˆ†æ•°
async checkDuplicate(playerName, score) {
  const data = await leaderboardService.getLeaderboard()

  // æŸ¥æ‰¾è¯¥ç©å®¶çš„æœ€é«˜åˆ†
  const playerScores = data.scores
    .filter(s => s.playerName === playerName)
    .sort((a, b) => b.score - a.score)

  if (playerScores.length > 0) {
    const bestScore = playerScores[0].score

    // å¦‚æœæ–°åˆ†æ•°æ²¡æœ‰æ˜æ˜¾æå‡ï¼Œæ‹’ç»æäº¤
    if (score <= bestScore * 1.05) { // æå‡<5%
      return {
        duplicate: true,
        bestScore,
        message: `ä½ å·²æœ‰æ›´é«˜çš„åˆ†æ•°: ${bestScore}`
      }
    }
  }

  return { duplicate: false }
}
```

### 3. æœ¬åœ°ç¼“å­˜ä¼˜åŒ– ğŸš€

**é—®é¢˜ï¼š** é¢‘ç¹è¯·æ±‚Pantry API

**è§£å†³æ–¹æ¡ˆï¼š**
```javascript
// ä½¿ç”¨ IndexedDB æŒä¹…åŒ–
class LeaderboardCache {
  async get() {
    // 1. å…ˆä» IndexedDB è¯»å–
    const local = await this.getFromIndexedDB()

    // 2. å¦‚æœæœ‰ç¼“å­˜ä¸”æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›
    if (local && Date.now() - local.timestamp < 300000) {
      return local.data
    }

    // 3. ä»æœåŠ¡å™¨è·å–
    const remote = await this.fetchFromAPI()

    // 4. ä¿å­˜åˆ° IndexedDB
    await this.saveToIndexedDB(remote)

    return remote
  }
}
```

### 4. é™çº§æ–¹æ¡ˆ ğŸ”„

**é—®é¢˜ï¼š** PantryæœåŠ¡å¯èƒ½ä¸ç¨³å®š

**è§£å†³æ–¹æ¡ˆï¼š**
```javascript
// åˆ†å±‚è·å–ç­–ç•¥
async getLeaderboardWithFallback() {
  try {
    // 1. å°è¯•ä» Pantry è·å–
    return await this.fetchFromPantry()
  } catch (error) {
    console.warn('Pantryè·å–å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ')

    try {
      // 2. å°è¯•ä» GitHub Gist è·å–ï¼ˆéœ€é…ç½®ï¼‰
      return await this.fetchFromGitHubGist()
    } catch (error2) {
      console.warn('GitHub Gistè·å–å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®')

      // 3. ä½¿ç”¨æœ¬åœ°é¢„è®¾çš„é«˜åˆ†æ•°æ®
      return this.getLocalDefaultData()
    }
  }
}
```

### 5. AIç”Ÿæˆä¼˜åŒ– ğŸ¤–

**å½“å‰æ–¹æ¡ˆï¼š** éšæœºä»æ’è¡Œæ¦œæŠ½å–

**æ›´å¥½çš„æ–¹æ¡ˆï¼š** æ™ºèƒ½åŒ¹é…

```javascript
// æ ¹æ®ç©å®¶å½“å‰çŠ¶æ€ç”ŸæˆåŒ¹é…çš„AI
async generateMatchedAI(player) {
  const targetMass = player.mass * (0.8 + Math.random() * 0.4) // ç©å®¶è´¨é‡çš„80%-120%

  // è·å–æ’è¡Œæ¦œä¸­ç›¸è¿‘åˆ†æ•°çš„ç©å®¶
  const candidates = await leaderboardService.getTopScores(1000)
    .then(scores => scores.filter(s =>
      s.score >= targetMass * 0.5 &&
      s.score <= targetMass * 1.5
    ))

  if (candidates.length > 0) {
    // éšæœºé€‰æ‹©ä¸€ä¸ª
    const selected = candidates[Math.floor(Math.random() * candidates.length)]
    return this._createPlayerFromLeaderboard(selected, 'normal')
  }

  // æ²¡æœ‰åŒ¹é…çš„ï¼Œç”ŸæˆåŸºç¡€AI
  return this._generateBasicAI(1, 'normal')[0]
}
```

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åœ¨æ¸¸æˆç»„ä»¶ä¸­ä½¿ç”¨

```vue
<script setup>
import { ref, onMounted } from 'vue'
import { submitScore, getTopScores } from '@/utils/leaderboardService.js'
import { generateAIPlayers, spawnPlayerAI } from '@/utils/aiPlayerGenerator.js'

const leaderboard = ref([])
const showSubmitDialog = ref(false)

// æ¸¸æˆç»“æŸæ—¶
async function onGameOver(gameData) {
  showSubmitDialog.value = true

  // ä¿å­˜æ¸¸æˆæ•°æ®
  currentGameData.value = gameData
}

// æäº¤æˆç»©
async function handleSubmitScore() {
  const result = await submitScore({
    playerName: playerName.value,
    score: currentGameData.value.score,
    kills: currentGameData.value.kills,
    survivalTime: currentGameData.value.survivalTime,
    mode: 'challenge',
    difficulty: 'normal',
    skin: 'rainbow',
    maxMass: currentGameData.value.maxMass
  })

  if (result.success) {
    alert(`ğŸ‰ ${result.message}`)
    showSubmitDialog.value = false
  } else {
    alert(`âŒ ${result.message}`)
  }
}

// ç”ŸæˆAI
async function initGame() {
  const aiPlayers = await generateAIPlayers({
    count: 20,
    minScore: 1000,
    difficulty: 'normal'
  })

  game.addAIPlayers(aiPlayers)
}

// æ— å°½æ¨¡å¼å®šæ—¶ç”ŸæˆAI
function setupEndlessMode() {
  setInterval(async () => {
    const aiPlayer = await spawnPlayerAI(
      game.time,
      player.mass * 0.8
    )

    game.addAI(aiPlayer)

    // æ˜¾ç¤ºæç¤º
    showNotification(`âš ï¸ ${aiPlayer.name} åŠ å…¥äº†æ¸¸æˆï¼`)
  }, 30000)
}

// åŠ è½½æ’è¡Œæ¦œ
onMounted(async () => {
  leaderboard.value = await getTopScores(100)
})
</script>
```

---

## âœ… æ€»ç»“

### ä¼˜ç‚¹
1. âœ… **ç®€å•æ˜“ç”¨**ï¼šPantry APIç®€å•ï¼Œæ— éœ€åç«¯
2. âœ… **çœŸå®æ„Ÿå¼º**ï¼šAIåŸºäºçœŸå®ç©å®¶æ•°æ®
3. âœ… **æ¿€åŠ±æœºåˆ¶**ï¼šç©å®¶æäº¤æˆç»©çš„åŠ¨åŠ›
4. âœ… **æ— éœ€ç»´æŠ¤**ï¼šæ²¡æœ‰æœåŠ¡å™¨æˆæœ¬

### é£é™©ä¸é™åˆ¶
1. âš ï¸ **æ•°æ®å®‰å…¨**ï¼šå®Œå…¨å…¬å¼€ï¼Œæ— è®¿é—®æ§åˆ¶
2. âš ï¸ **å¯èƒ½åˆ·åˆ†**ï¼šç¼ºå°‘æœåŠ¡ç«¯éªŒè¯
3. âš ï¸ **å¹¶å‘é—®é¢˜**ï¼šå¤šç©å®¶åŒæ—¶æäº¤å¯èƒ½è¦†ç›–æ•°æ®
4. âš ï¸ **æœåŠ¡é™åˆ¶**ï¼šPantryå¯èƒ½æœ‰é¢‘ç‡é™åˆ¶

### é€‚ç”¨åœºæ™¯
- âœ… å°å‹é¡¹ç›®ï¼ˆ<1000æ´»è·ƒç”¨æˆ·ï¼‰
- âœ… åŸå‹å¼€å‘
- âœ… ä¸ªäººé¡¹ç›®
- âœ… å­¦ä¹ é¡¹ç›®

### ä¸é€‚ç”¨åœºæ™¯
- âŒ å¤§å‹å•†ä¸šé¡¹ç›®
- âŒ éœ€è¦ä¸¥æ ¼é˜²ä½œå¼Šçš„é¡¹ç›®
- âŒ éœ€è¦å®æ—¶åŒæ­¥çš„é¡¹ç›®

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2026-02-09
**ç»´æŠ¤è€…**: Claude AI Assistant
